import{a as v}from"./index-CmmzNXUp.js";import{B as C}from"./Button-BmV_rm9T.js";import{d as M,k as z,b as a,u as r,o as n,e as l,i,t as d,j as s,g as f,f as k,N as _,a4 as T,l as B}from"./app-D0kw2imx.js";import{N as m}from"./Alert-iPJdJXhU.js";import{N as b}from"./Input-BL-6jE_H.js";import{_ as P}from"./plugin-vue_export-helper-DlAUqK2U.js";const U={key:2},j=M({__name:"Callback",setup(w){const p=new URL(window.location.href),c=p.searchParams.get("code"),u=p.searchParams.get("state"),g=p.searchParams.get("error"),h=p.searchParams.get("error_description"),e=z({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1});c&&u&&!g&&(()=>{fetch(`${v()}/alist/onedrive/get_refresh_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:c,client:u})}).then(o=>o.json()).then(o=>{if(console.log(o),o.error){e.error1=o.error,e.errorMessage1=o.error_description;return}e.refreshToken=o.refresh_token,e.accessToken=o.access_token})})();const[I,N,y]=atob(u).split("::"),S=()=>{e.gettingSiteId=!0,fetch(`${v()}/alist/onedrive/get_site_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:e.siteUrl,access_token:e.accessToken,zone:y})}).then(o=>(e.gettingSiteId=!1,o.json())).then(o=>{if(o.error){e.error2=o.error,e.errorMessage2=o.error.message;return}e.siteId=o.id})};return(o,t)=>!r(c)||!r(u)||r(g)?(n(),a(r(m),{key:0,title:r(g)||"Error",type:"error"},{default:l(()=>[i(d(r(h)),1)]),_:1},8,["title"])):(n(),a(r(_),{key:1,vertical:"",size:"large"},{default:l(()=>[s("p",null,[t[1]||(t[1]=s("b",null,"client_id: ",-1)),i(d(r(I)),1)]),s("p",null,[t[2]||(t[2]=s("b",null,"client_secret: ",-1)),i(d(r(N)),1)]),s("p",null,[t[3]||(t[3]=s("b",null,"zone: ",-1)),i(d(r(y)),1)]),t[8]||(t[8]=s("p",null,[s("b",null,"redirect_uri: "),i("https://alist.nn.ci/tool/onedrive/callback")],-1)),e.error1||e.errorMessage1?(n(),a(r(m),{key:0,title:e.error1,type:"error"},{default:l(()=>[i(d(e.errorMessage1),1)]),_:1},8,["title"])):f("v-if",!0),k(r(_),{vertical:""},{default:l(()=>[t[4]||(t[4]=s("b",null,"refresh_token:",-1)),!e.refreshToken&&!e.errorMessage1?(n(),a(r(T),{key:0})):(n(),a(r(b),{key:1,type:"textarea",autosize:"",readonly:"",value:e.refreshToken},null,8,["value"]))]),_:1,__:[4]}),e.accessToken?(n(),a(r(_),{key:1,vertical:"",size:"large"},{default:l(()=>[t[7]||(t[7]=s("h3",null,"Get sharepoint site ID",-1)),e.error2||e.errorMessage2?(n(),a(r(m),{key:0,title:e.error2,type:"error"},{default:l(()=>[i(d(e.errorMessage2),1)]),_:1},8,["title"])):f("v-if",!0),k(r(b),{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.siteUrl,"onUpdate:value":t[0]||(t[0]=x=>e.siteUrl=x)},null,8,["value"]),k(r(C),{type:"primary",size:"large",onClick:S},{default:l(()=>t[5]||(t[5]=[i("Get SiteID")])),_:1,__:[5]}),e.gettingSiteId?(n(),a(r(T),{key:1})):e.siteId?(n(),B("p",U,[t[6]||(t[6]=s("b",null,"site_id: ",-1)),i(d(e.siteId),1)])):f("v-if",!0)]),_:1,__:[7]})):f("v-if",!0)]),_:1,__:[8]}))}}),A=P(j,[["__scopeId","data-v-109d5915"]]);export{A as C};
