import{a as N}from"./index-CmmzNXUp.js";import{N as x}from"./Input-BL-6jE_H.js";import{B as b}from"./Button-BmV_rm9T.js";import{N as w}from"./Alert-iPJdJXhU.js";import{d as V,r,b as l,o as s,e as a,f as o,g as u,u as t,i as n,t as P,N as c,j as B}from"./app-D0kw2imx.js";import{N as j}from"./Image-C4NwYRR4.js";const O=V({__name:"Token",setup(q){const p=r(""),_=r(""),k=r({uid:"",time:0,qrcode:"",sign:""}),i=r(""),m=r(""),y=r(!1);async function S(){y.value=!0,i.value="";const e=await(await fetch(N(`/alist/115/auth_device_code?app_id=${p.value}`))).json();if(y.value=!1,e.error){i.value=e.error;return}_.value=e.code_verifier,k.value=e.resp;const d=new URL(N("/qr"));d.searchParams.set("text",k.value.qrcode),m.value=d.toString()}const g=r(!1),v=r(""),f=r({access_token:"",refresh_token:"",expires_in:0});async function T(){g.value=!0,v.value="";const e=await(await fetch(N("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:_.value,uid:k.value.uid})})).json();if(g.value=!1,e.error){v.value=e.error;return}f.value=e.resp}return(C,e)=>(s(),l(t(c),{vertical:"",size:"large"},{default:a(()=>[o(t(x),{value:p.value,"onUpdate:value":e[0]||(e[0]=d=>p.value=d),placeholder:"APP ID, 不填则使用 Alist 默认提供"},null,8,["value"]),_.value?u("v-if",!0):(s(),l(t(b),{key:0,block:"",type:"primary",onClick:S,loading:y.value},{default:a(()=>e[1]||(e[1]=[n("生成二维码")])),_:1,__:[1]},8,["loading"])),i.value?(s(),l(t(w),{key:1,title:"Error",type:"error"},{default:a(()=>[n(P(i.value),1)]),_:1})):u("v-if",!0),m.value?(s(),l(t(c),{key:2,vertical:""},{default:a(()=>[o(t(c),{justify:"center"},{default:a(()=>[o(t(j),{width:"300",src:m.value},null,8,["src"])]),_:1}),o(t(w),{title:"扫描二维码",type:"info"},{default:a(()=>e[2]||(e[2]=[n("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1,__:[2]}),o(t(b),{size:"large",onClick:T,type:"info",block:"",loading:g.value},{default:a(()=>e[3]||(e[3]=[n("已扫码")])),_:1,__:[3]},8,["loading"]),v.value?(s(),l(t(w),{key:0,title:"Error",type:"error"},{default:a(()=>[n(P(v.value),1)]),_:1})):u("v-if",!0)]),_:1})):u("v-if",!0),f.value.refresh_token?(s(),l(t(c),{key:3,vertical:""},{default:a(()=>[e[4]||(e[4]=B("b",null,"refresh_token:",-1)),o(t(x),{type:"textarea",autosize:"",readonly:"",value:f.value.refresh_token},null,8,["value"]),e[5]||(e[5]=B("b",null,"access_token:",-1)),o(t(x),{type:"textarea",autosize:"",readonly:"",value:f.value.access_token},null,8,["value"])]),_:1,__:[4,5]})):u("v-if",!0)]),_:1}))}});export{O as _};
